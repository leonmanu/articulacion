<!DOCTYPE html>
<html lang="en">
<head>
    <%- include('../../partials/header') %> 
</head>
<body>
    <%- include('../../partials/spinner') %> 
    <%- include('../../partials/navbar') %> 
    
    <!-- Navbar secundario -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light">
        <div class="container">
            <div class="navbar-brand">
                <span class="fw-bolder" id="claveEscuela">Admin</span> / Estudiantes salientes
            </div>
        </div>
    </nav>

    <!-- Contenido Principal -->
    <div class="container mt-4">
        <table class="table table-striped table-hover"
            id="table"
            data-filter-control="true">
            <thead class="table-primary text-center">
                <tr>
                    <th data-field="estudiante" data-sortable="true" data-filter-control="input">Estudiante</th>
                    <th data-field="documento" data-sortable="true" data-filter-control="input">Documento</th>
                    <th data-field="escuelaOrigen" data-sortable="true" data-filter-control="input">Escuela Origen</th>
                    <th data-field="curso" data-sortable="true" data-filter-control="input">Curso</th>
                    <th data-field="escuelaDestino" data-sortable="true" data-filter-control="input">Escuela Destino</th>
                    <th data-field="estado" data-sortable="true" data-filter-control="select">Estado</th>
                </tr>
            </thead>
            <tbody>
                <% estudiantes.forEach(estudiante => { %>
                    <% 
                        // Buscar el traspaso correspondiente al estudiante
                        const traspaso = traspasos.find(t => t.documento === estudiante.documento);
                        const escuelaDestino = traspaso ? traspaso.escuelaDestino : 'Sin destino';
                        const estadoTraspaso = traspaso ? traspaso.estado : 0; 
                    %>
                    <tr>
                        <td class=""><%= estudiante.estudiante || 'Sin nombre' %></td>
                        <td class="text-center"><%= estudiante.documento || 'Sin documento' %></td>
                        <td class="text-center"><%= estudiante.claveEscuela || 'Sin escuela' %></td>
                        <td class="text-center"><%= estudiante.claveCurso || 'Sin curso' %></td>
                        <td class="text-center"><%= escuelaDestino %></td>
                        <td class="text-center">
                            <% if (estadoTraspaso === '1') { %>
                                <span>pendiente</span>
                            <% } else if (estadoTraspaso === '2') { %>
                                <span style="color: green;">confirmado</span>
                            <% } else if (estadoTraspaso === '3') { %>
                                <span style="color: red;">rechazado</span>
                            <% } else { %>
                                <span>sin traspaso</span>
                            <% } %>
                        </td>
                    </tr>
                <% }); %>
            </tbody>
        </table>
    </div>
    <%- include('../../partials/footer') %> 
    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>

<script>
    $(function() {
      $('#table').bootstrapTable()
    })
  </script>